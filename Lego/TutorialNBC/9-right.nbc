#define MOVE_TIME   800
#define TURN_TIME   200

dseg segment
  motor_control mutex
  Switch sword 0
  buf byte[]
dseg ends

thread main
  precedes move_square, check_sensors
  SetSensorTouch(IN_1)
  exit
endt

thread move_square
SquareLoop:
  acquire motor_control
  OnFwd(OUT_BC,100)
  release motor_control
  wait MOVE_TIME
  acquire motor_control
  OnRev(OUT_C,100)
  release motor_control
  wait TURN_TIME
  jmp SquareLoop
endt

thread check_sensors
SensorLoop:
  ReadSensor(IN_1,Switch)
  brtst EQ, SensorLoop, Switch
  acquire motor_control
  OnRev(OUT_BC,100)
  wait 50
  Off(OUT_C)
  wait 85
  release motor_control
  jmp SensorLoop
endt

